---
title: "LDF Method Example"
author: "CLRS 2015 Concurrent Session ST-6"
date: "Thursday, September 10, 2015"
output: html_document
---

# Actuarial Assignment: Estimate ultimate loss from the RAA data

Load the ChainLadder package and view the RAA triangle (included therein).

```{r}
suppressPackageStartupMessages(library(ChainLadder))
RAA
```

Form the triangle of age-to-age factors and 
initially select the weighted average link ratios.

```{r}
ataRAA <- ata(RAA)
ataRAA
selectedATA <- round(attr(ataRAA, "vwtd"), 3)
selectedATA
```

## Analyze Tail

The average link ratios seem to follow a pattern.

```{r}
plot(log(selectedATA - 1))
x <-1:9
y <- log(selectedATA - 1)
lm(y~x)
abline(lm(y~x))
```

Assuming the pattern continues,
what magnitude of tail is implied? 
Investigate the next 10 years versus the next 100 years.

```{r}
age <- 10:19
tail(cumprod(exp(0.9045 - 0.6340 * age) + 1), 1)
```

Over the next 100 years, 
the tail would be
`r tail(cumprod(exp(0.9045 - 0.6340 * 10:109) + 1), 1)`.
(Not shown. Homework problem!)

With that as justification, we select a tail factor of 1.010.

In addition, for illustration we 
select the greater of the two calculated averages
(the simple average) for the first link ratio.

We now make all those assignments and 
build the cumulative loss development pattern (CDF):

``` {r}
tail = 1.01
selectedATA[1] <- attr(ataRAA, 'smpl')[1]
CDF <- round(cumprod(rev(c(selectedATA, tail))), 3)
rbind(selectedATA = round(c(selectedATA, tail = tail), 3), 
      CDF = rev(CDF))
```

## Project to ultimate

Using the CDF vector, we develop the latest diagonal to ultimate. 
We place all pertinent values,
including totals,
into a table that automatically appears in the documentation
and, if desired, could be saved to a spreadsheet for later analysis.

``` {r}
Latest = getLatestCumulative(RAA)
Ultimate = round(Latest * CDF, 0)
IBNR = Ultimate - Latest
LDEstimate <- data.frame(Latest, CDF, Ultimate, IBNR)
Total <- colSums(LDEstimate)
Total[2] <- NA
LDEstimate <- rbind(LDEstimate, Total = Total)
LDEstimate
```

